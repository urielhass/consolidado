<div>
	<md-toolbar class="md-table-toolbar md-default">
		<div class="md-toolbar-tools">
			<span>TODAS REQUISIÇÕES</span>
			<span flex></span>
			<div ng-show="showSearch" flex="auto">
				<md-button style="float: right;" class="md-icon-button" aria-label="Search" ng-click="showSearch = false; search = '';">
					<md-icon class="whitet">close</md-icon>
				</md-button>
				<input class="input-search" ng-model="search" placeholder="Pesquisar...">				
			</div>
			<div ng-show="!showSearch">
				<md-button class="md-icon-button" aria-label="Search" ng-click="showSearch = true">
					<md-icon class="whitet">search</md-icon>
				</md-button>
			</div>
		</div>
	</md-toolbar>
	<md-table-container style="overflow: auto;max-height: 300px;">
		<table md-table multiple>
			<thead md-head>
				<tr md-row>
					<th md-column><span>ID<span></th>
					<th md-column><span>ESTOQUE</span></th>
					<th md-column><span>STATUS</span></th>
					<th md-column><span>DATA REQ.</span></th>
					<th md-column><span>REQ. POR</span></th>
					<th md-column><span>AÇÃO</span></th>
					<!-- th md-column><span>COD.</span></th>
					<th md-column><span>TÃ�TULO</span></th>
					<th md-column><span>QUANTIDADE</span></th>
					<th md-column><span>STATUS</span></th>
					<th md-column><span>DATA REQ.</span></th>
					<th md-column><span>REQ. POR</span></th>
					<th md-column><span>AÃ‡ÃƒO</span></th-->
				</tr>
			</thead>
			<tbody md-body>
				<tr md-row
				ng-repeat="item in listRequest | filter:search">
				<td md-cell>{{item.id}}</td>
				<td md-cell>
					<md-button class="md-icon-button" ng-click="viewStock(item.id);" title="VISUALIZAR O ESTOQUE" aria-label="deleteUser">
						<md-icon class="material-icons">visibility</md-icon>
					</md-button>
				</td>
				<!--<td md-cell>{{item.quantity}}</td>-->
				<td md-cell>{{item.status | traslateStatus}}</td>
				<td md-cell>{{item.dateRequest | date:'dd/MM/yyyy HH:mm:ss' : 'UTC'}}</td>
				<td md-cell>{{item.user.name}}</td>
				<!-- td md-cell>{{item.Id}}</td>
				<td md-cell>{{item.stock.name}}</td>
				<td md-cell>{{item.quantity}}</td>
				<td md-cell>{{item.status | traslateStatus}}</td>
				<td md-cell>{{item.dateRequest | date:'dd/MM/yyyy HH:mm:ss' : 'UTC'}}</td>
				<td md-cell>{{item.user.name}}</td-->
				<td md-cell>
					<md-menu ng-if="item.user.email == emailUser && item.status != 30 && item.status != 50 && item.status != 60" md-offset="0 -7">
						<md-button aria-label="Open demo menu" class="md-icon-button" ng-click="$mdOpenMenu($event)">
							<md-icon class="material-icons">more_vert</md-icon>
						</md-button>
						<md-menu-content width="2">
							<!--<md-menu-item>
							<md-button ng-click="">
							<md-icon class="material-icons">edit</md-icon>
							<span md-menu-align-target>Editar</span>
						</md-button>
					</md-menu-item>-->
					<md-menu-item>
						<md-button ng-click="remove(item,$index)">
							<md-icon class="material-icons">delete_forever</md-icon>
							<span md-menu-align-target>DELETAR</span>
						</md-button>
					</md-menu-item>
				</md-menu-content>
			</md-menu>
			<md-button class="md-icon-button" ng-if="item.user.email == emailUser && item.status == 50" ng-click="confirm(item.id)">
				<md-icon class="material-icons">check</md-icon>
			</md-button>
		</td>
	</tr>
	<tr md-row ng-show="!(listRequest| filter:search).length">
		<td colspan="6" md-cell>Nenhuma requisição encontrada</td>
	</tr>
</tbody>
</table>
</md-table-container>
</div>

<script type="text/ng-template" id="requestModal.html">
	<md-dialog aria-label="RequestModal" style="min-width: 900px;">

		<md-toolbar class="primary-color">
			<div class="md-toolbar-tools">
				<h2>REQUISIÇÃO</h2>
				<span flex></span>
				<md-button class="md-icon-button" ng-click="ctrl.cancel()">
					<md-icon class="material-icons">close</md-icon>
				</md-button>
			</div>
		</md-toolbar>

		<md-dialog-content ng-cloak>
			<div class="md-dialog-content">
				<form ng-submit="$event.preventDefault()">
					<p>Selecione o produto para Requisitar.</p>
					<md-autocomplete
					md-selected-item="ctrl.selectedItem"
					md-search-text="ctrl.searchText"
					md-items="item in ctrl.querySearch(ctrl.searchText)"
					md-item-text="item.title"
					md-min-length="0"
					placeholder="Selecione o estoque a ser requisitado:"
					md-selected-item-change="ctrl.add(item)"
					md-autofocus>
					<md-item-template>
						<span md-highlight-text="ctrl.searchText" md-highlight-flags="^i">{{item.title}}</span>
					</md-item-template>
					<md-not-found>
						No states matching "{{ctrl.searchText}}" were found.
					</md-not-found>
				</md-autocomplete>
			</form>

			<div layout="column">
				<md-card ng-repeat="item in requestsProduct">
					<md-card-title>
						<md-card-title-text flex="95">
							<span class="md-headline">{{item.stock.title}}</span>
						</md-card-title-text>
						<div flex="5" class="close-card">
							<md-button class="md-icon-button" aria-label="delete product" ng-click="deleteProduct($index)">
								<md-icon class="material-icons">close</md-icon>
							</md-button>
						</div>
					</md-card-title>
					<md-card-content>
						<md-input-container class="md-icon-float md-block" flex="15">
							<label>Quantidade</label>
							<input ng-model="item.quantity" type="text">
						</md-input-container>
						<md-input-container class="md-icon-float md-block" flex="15">
							<label>Data de entrega</label>
							<input date-format ng-model="item.scheduleDate" type="text">
						</md-input-container>
					</md-card-content>
				</md-card>
			</div>
		</div>
	</md-dialog-content>

	<md-dialog-actions>
		<md-button aria-label="Finished" ng-click="ctrl.cancel($event)">CANCELAR</md-button>
		<md-button aria-label="Finished" ng-click="ctrl.finish($event,requestsProduct)">CONFIRMAR</md-button>
	</md-dialog-actions>
</md-dialog>

</script>

<script type="text/ng-template" id="requestViewModal.html">
	<md-dialog aria-label="RequestModal" style="width: 50%;">
		<md-toolbar class="primary-color">
			<div class="md-toolbar-tools">
				<h2>INFORMAÇÕES DA REQUISIÇÃO</h2>
				<span flex></span>
				<md-button class="md-icon-button" ng-click="ctrl.cancel()">
					<md-icon class="material-icons">close</md-icon>
				</md-button>
			</div>
		</md-toolbar>
		<md-dialog-content ng-cloak>
			<div class="md-dialog-content" ng-repeat="item in ctrl.listStock">
				<p><strong>Título: </strong> {{item.stock.title}}</p>
				<p><strong>Quantidade: </strong> {{item.quantity}}</p>
				<p><strong>Valor unitário: </strong> R$ {{item.stock.unitaryValue}}</p>
				<p><strong>Valor total do item: </strong> R$ {{item.stock.unitaryValue * item.quantity}}</p>
			</div>
			<div class="md-dialog-content">
				<p><strong>Quantidade total: </strong> {{ctrl.total}}</p>
				<p><strong>Valor total: </strong> R$ {{ctrl.totalValue}}</p>
			</div>
		</md-dialog-content>
	</md-dialog>
</script>

